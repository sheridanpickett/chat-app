(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{52:function(e,n,t){e.exports=t(98)},87:function(e,n){},98:function(e,n,t){"use strict";t.r(n);var o=t(0),r=t.n(o),a=t(10),c=t.n(a),u=t(4),i=t(21),s=t(47),m=t(5),l=t(12),f=t(1);function d(e){var n=function(e,n){if("object"!==typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!==typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"===typeof n?n:String(n)}var b={user:{name:"",id:""},rooms:[],activeRoom:null,roomInfo:{}},g=function(e,n){var t=e.slice();return t.splice(n,1),t},v=function(e,n){var t=e.slice(),o=e.map(function(e,t){return e.id===n?t:null});return t.splice(o,1),t},O=function(e,n,t){var o=e.slice();return o[t]=n,o},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"UPDATE_USER":return Object.assign({},e,{user:n.user});case"UPDATE_ACTIVE_ROOM":return Object.assign({},e,{activeRoom:n.index});case"ADD_ROOM":return Object(f.a)({},e,{rooms:[].concat(Object(l.a)(e.rooms),[""])});case"UPDATE_ROOM":var t=n.room;return e.roomInfo[t]?Object(f.a)({},e,{rooms:O(e.rooms,t,e.activeRoom)}):Object(f.a)({},e,{rooms:O(e.rooms,n.room,e.activeRoom),roomInfo:Object(f.a)({},e.roomInfo,Object(m.a)({},n.room,{messages:[],users:[],loading:!0}))});case"DELETE_ROOM":return Object(f.a)({},e,{rooms:g(e.rooms,n.index)});case"DELETE_ROOM_INFO":var o=e.roomInfo,r=n.room,a=(o[r],Object(s.a)(o,[r].map(d)));return Object(f.a)({},e,{roomInfo:Object(f.a)({},a)});case"ADD_MESSAGE":return Object(f.a)({},e,{roomInfo:Object(f.a)({},e.roomInfo,Object(m.a)({},n.message.room,Object(f.a)({},e.roomInfo[n.message.room],{messages:[].concat(Object(l.a)(e.roomInfo[n.message.room].messages),[n.message])})))});case"ADD_MESSAGES":return Object(f.a)({},e,{roomInfo:Object(f.a)({},e.roomInfo,Object(m.a)({},n.room,Object(f.a)({},e.roomInfo[n.room],{messages:[].concat(Object(l.a)(n.messages),Object(l.a)(e.roomInfo[n.room].messages))})))});case"ADD_USER_TO_ROOM":return e.roomInfo[n.room].users.map(function(e){return e.id}).includes(n.user.id)?Object(f.a)({},e):Object(f.a)({},e,{roomInfo:Object(f.a)({},e.roomInfo,Object(m.a)({},n.room,Object(f.a)({},e.roomInfo[n.room],{users:[].concat(Object(l.a)(e.roomInfo[n.room].users),[n.user])})))});case"REMOVE_USER_FROM_ROOM":return Object(f.a)({},e,{roomInfo:Object(f.a)({},e.roomInfo,Object(m.a)({},n.room,Object(f.a)({},e.roomInfo[n.room],{users:v(e.roomInfo[n.room].users,n.id)})))});case"SET_ROOM_LOADING":return Object(f.a)({},e,{roomInfo:Object(f.a)({},e.roomInfo,Object(m.a)({},n.room,Object(f.a)({},e.roomInfo[n.room],{loading:n.isLoading})))});case"SET_ROOM_NEW_MESSAGE":return""!==n.room?Object(f.a)({},e,{roomInfo:Object(f.a)({},e.roomInfo,Object(m.a)({},n.room,Object(f.a)({},e.roomInfo[n.room],{newMessage:n.newMessage})))}):e;default:return e}},E=function(e){return{type:"UPDATE_USER",user:e}},j=function(e){return{type:"UPDATE_ACTIVE_ROOM",index:e}},h=function(e){return{type:"DELETE_ROOM_INFO",room:e}},R=function(e,n){return{type:"SET_ROOM_LOADING",room:e,isLoading:n}},x=function(e,n){return{type:"SET_ROOM_NEW_MESSAGE",room:e,newMessage:n}},w=t(8),I=t(48),y=t.n(I)()("http://127.0.0.1:4000"),_=t(2),k=t(3);function M(){var e=Object(_.a)(['\n\tdisplay: flex;\n\tposition: absolute;\n\tfont-family: "Geneva";\n\theight: 100vh;\n\tmin-width: 100vw;\n']);return M=function(){return e},e}var S=k.a.div(M());function D(){var e=Object(_.a)(["\n  width: 20%;\n  background-color: rgba(0,0,20,0.04);\n  border-right: 1px solid rgb(52,73,94, 0.3);\n"]);return D=function(){return e},e}var T=k.a.div(D());function A(){var e=Object(_.a)(["\n  margin: 5px;\n  color: white;\n  width: 70px;\n  background-color: #34495e;\n  border: 1px solid #34495e;\n  font-size: .9em;\n  border-radius: 4px;\n  :hover {\n    background-color: #425ff4;\n  }\n  :active{\n    background-color: #34495e;\n  }\n"]);return A=function(){return e},e}var N=k.a.button(A()),U=Object(u.b)(function(e){return{user:e.user,rooms:e.rooms}},function(e){return{updateUser:function(n){return e(E(n))},deleteRoomInfo:function(n){return e(h(n))}}})(function(e){var n=e.user,t=e.rooms,o=e.updateUser;e.deleteRoomInfo;return r.a.createElement(N,{onClick:function(){t.forEach(function(e){y.emit("leave room",e)}),o(Object(f.a)({},n,{name:""}))}},"Log out")});function L(){var e=Object(_.a)(["\n  padding: 5px;\n"]);return L=function(){return e},e}var C=k.a.div(L()),F=Object(u.b)(function(e){var n=e.rooms[e.activeRoom];return e.roomInfo[n]&&""!==n?{users:e.roomInfo[e.rooms[e.activeRoom]].users.map(function(e){return r.a.createElement("div",null,e.name)})}:{}})(function(e){var n=e.users;return r.a.createElement(C,null,"Users in room:",n)}),G=Object(u.b)(function(e){return{user:e.user}})(function(e){var n=e.user;return r.a.createElement(T,null,n.name&&r.a.createElement(r.a.Fragment,null,r.a.createElement(U,null),r.a.createElement(F,null)))});function P(){var e=Object(_.a)(["\n  display: flex;\n  justify-content: space-between;\n  height: 50px;\n  margin: 8px;\n  border-radius: 4px;\n  overflow: hidden;\n  box-shadow: inset 0 1px 3px rgba(0,0,0,0.06), 0 1px 1px rgba(255,255,255,0.2);\n  input {\n    width: 100%;\n    padding: 0 10px;\n    font-size: 1em;\n    background-color: rgba(255,255,255,.5);\n    border-radius: 4px 0px 0px 4px;\n    border: 1px solid rgba(0,0,0,0.16);\n    border-right: none;\n  }\n  button {\n\t\theight: 100%;\n    width: 70px;\n\t\tbackground-color: #34495e;\n    border: 1px solid #34495e;\n    font-size: .9em;\n    border-radius: 0px 4px 4px 0px;\n    :hover {\n      background-color: #425ff4;\n    }\n    :active{\n      background-color: #34495e;\n    }\n    span{\n      text-align: center;\n      margin: auto;\n      color: white;\n      padding: 0 5px;\n    }\n  }\n"]);return P=function(){return e},e}var z=k.a.form(P()),V=function(e){var n=e.placeholder,t=e.buttonText,a=e.onClick,c=Object(o.useState)(""),u=Object(w.a)(c,2),i=u[0],s=u[1];return r.a.createElement(z,null,r.a.createElement("input",{type:"text",placeholder:n,value:i,onChange:function(e){return s(e.target.value)}}),r.a.createElement("button",{onClick:function(e){e.preventDefault(),""!==i&&(a(i),s(""))}},r.a.createElement("span",null,t)))};function H(){var e=Object(_.a)(["\n  text-align: center;\n  margin: auto;\n"]);return H=function(){return e},e}var J=k.a.div(H()),W=Object(u.b)(function(e){return{user:e.user}},function(e){return{updateUser:function(n){return e(E(n))}}})(function(e){var n=e.updateUser,t=e.user;return r.a.createElement(J,null,"Enter your name to get started",r.a.createElement(V,{placeholder:"Enter your name",buttonText:"Submit",onClick:function(e){return n(Object(f.a)({},t,{name:e}))}}))});function X(){var e=Object(_.a)(["\n  display: grid;\n  width: 80%;\n  grid-template-rows: auto 1fr auto;\n  grid-template-columns: 1fr;\n"]);return X=function(){return e},e}var B=k.a.div(X()),Y=t(22),$=t.n(Y);function q(){var e=Object(_.a)(["\n  display: grid;\n  overflow: hidden;\n  grid-auto-columns: minmax(0, 100px);\n  grid-auto-flow: column;\n  height: 60px;\n  border-bottom: 1px solid rgb(52,73,94, 0.3);\n"]);return q=function(){return e},e}var K=k.a.div(q());function Q(){var e=Object(_.a)(["\n  position: relative;\n  display: inline-block;\n  background-color: rgba(0,0,20,0.04);\n  max-width: 100px;\n  border-right: 1px solid rgb(52,73,94, 0.3);\n  overflow: hidden;\n  .is-active {\n    color: #44a6c6\n  }\n  :hover {\n    background-color: rgba(0,0,20,0.1);\n  }\n  :active {\n    background-color: rgba(0,0,20,0.04);\n  }\n  button {\n    position: absolute;\n    top: 0;\n    right: 0;\n    z-index: 1;\n    color: white;\n    background-color: #34495e;\n    border: 1px solid #34495e;\n    font-size: .9em;\n    border-radius: 0 0 0 4px;\n    :hover {\n      background-color: #425ff4;\n    }\n    :active{\n      background-color: #34495e;\n    }\n  }\n  div {\n    padding: 5px;\n    white-space: nowrap;\n  }\n  span span {\n    padding: 5px;\n    font-size: 1.5em;\n    line-height: 1em \n  }\n"]);return Q=function(){return e},e}var Z=k.a.div(Q()),ee=Object(u.b)(function(e,n){var t=!1;return e.roomInfo[n.room]&&(t=e.roomInfo[n.room].newMessage),{activeRoom:e.activeRoom,rooms:e.rooms,user:e.user,room:n.room,index:n.index,newMessage:t}},function(e){return{updateActiveRoom:function(n){return e(j(n))},deleteRoom:function(n){return e(function(e){return{type:"DELETE_ROOM",index:e}}(n))},deleteRoomInfo:function(n){return e(h(n))},setRoomNewMessage:function(n,t){return e(x(n,t))}}})(function(e){var n=e.index,t=e.room,a=e.user,c=e.rooms,u=e.activeRoom,i=e.newMessage,s=e.updateActiveRoom,m=e.deleteRoom,l=e.deleteRoomInfo,f=e.setRoomNewMessage;return Object(o.useEffect)(function(){f(c[u],!1)},[u,c]),r.a.createElement(Z,{onClick:function(){return s(n)}},r.a.createElement("span",null,r.a.createElement("button",{onClick:function(e){n===u?(1===c.length?s(null):n===c.length-1?s(n-1):s(n),m(n)):(n<u&&s(u-1),m(n));var o=c.slice();o.splice(n,1),o.includes(t)||""!==t&&(l(t),y.emit("leave room",t,a)),e.stopPropagation()}},"x"),i&&r.a.createElement("span",{style:{color:"red"}},".")),r.a.createElement("br",null),r.a.createElement("div",{className:n===u&&"is-active"},t||"New Room"))});function ne(){var e=Object(_.a)(["\n  text-align: center;\n  font-size: 2em;\n  border-right: 3px solid white;\n  background-color: rgba(0,0,20,0.04);\n  :hover {\n    background-color: rgba(0,0,20,0.1);\n  }\n  :active {\n    background-color: rgba(0,0,20,0.04);\n  }\n"]);return ne=function(){return e},e}var te=k.a.div(ne()),oe=Object(u.b)(function(e){return{rooms:e.rooms}},function(e){return{addRoom:function(){return e({type:"ADD_ROOM"})},updateActiveRoom:function(n){return e(j(n))}}})(function(e){var n=e.rooms,t=e.addRoom,o=e.updateActiveRoom;return r.a.createElement(te,{onClick:function(){t(),o(n.length)}},r.a.createElement("span",null,"+"))}),re=Object(u.b)(function(e){return{rooms:e.rooms}})(function(e){var n=e.rooms.map(function(e,n){return r.a.createElement(ee,{key:Object(Y.generate)(),room:e,index:n})});return r.a.createElement(K,null,n,r.a.createElement(oe,null))});function ae(){var e=Object(_.a)(["\n  text-align: center;\n  margin: auto;\n"]);return ae=function(){return e},e}var ce=k.a.div(ae()),ue=Object(u.b)(function(e){return{rooms:e.rooms,user:e.user}},function(e){return{updateRoom:function(n){return e(function(e){return{type:"UPDATE_ROOM",room:e}}(n))},addRoom:function(){return e({type:"ADD_ROOM"})},updateActiveRoom:function(n){return e(j(n))},setRoomLoading:function(n,t){return e(R(n,t))}}})(function(e){var n=e.rooms,t=e.user,o=e.addRoom,a=e.updateActiveRoom,c=e.updateRoom;e.setRoomLoading;return r.a.createElement(ce,null,r.a.createElement(V,{placeholder:"Join Room",buttonText:"Join",onClick:function(e){n.includes(e)||""===e||(y.emit("join room",e,t),y.emit("get messages",e),n.length<1&&(o(),a(0)),c(e))}}))});function ie(){var e=Object(_.a)(["\n  display: grid;\n  grid-template-rows: 1fr;\n  grid-auto-rows: auto;\n  overflow-y: scroll;\n  width: 100%;\n"]);return ie=function(){return e},e}var se=k.a.div(ie());function me(){var e=Object(_.a)(["\n  margin: 5px;\n  .outer {\n    padding: 5px;\n    display: inline-block;\n    border-radius: 5px;\n    background-color: rgba(0,0,20,0.04);\n  }\n  .inner {\n    font-size: .7em\n  }\n  .name {\n    color: #44a6c6\n  }\n"]);return me=function(){return e},e}var le=k.a.div(me());function fe(){var e=Object(_.a)(["\n  text-align: center;\n  display: flex;\n  justify-content: center;\n  padding: 8px;\n  div {\n    margin: auto 5px;\n    width: 9px;\n    height: 9px;\n    background-color: #34495e;\n    border-radius: 100%;\n    -webkit-animation: sk-bouncedelay 1.4s infinite ease both;\n    animation: sk-bouncedelay 1.4s infinite ease both;\n  }\n  .bounce1 {\n    -webkit-animation-delay: -0.32s;\n    animation-delay: -0.32s;\n  }\n  .bounce2 {\n    -webkit-animation-delay: -0.16s;\n    animation-delay: -0.16s;\n  }\n  @-webkit-keyframes sk-bouncedelay {\n    0%, 100% { -webkit-transform: scale(0) }\n    50% { -webkit-transform: scale(1.0) }\n  }\n  @keyframes sk-bouncedelay {\n    0%, 100% {\n      -webkit-transform: scale(0);\n      transform: scale(0);\n    } 50% {\n      -webkit-transform: scale(1.0);\n      transform: scale(1.0);\n    }\n  }\n"]);return fe=function(){return e},e}var de=k.a.div(fe()),be=function(){return r.a.createElement(de,null,r.a.createElement("div",{className:"bounce1"}),r.a.createElement("div",{className:"bounce2"}),r.a.createElement("div",{className:"bounce3"}))},ge=Object(u.b)(function(e){var n=e.rooms[e.activeRoom],t=e.roomInfo[n].loading,o=null;return e.roomInfo[n].messages[0]&&(o=e.roomInfo[n].messages[0].dateTime.dateInt),{loading:t,messages:e.roomInfo[n].messages,room:n,dateInt:o}})(function(e){var n=e.messages,t=e.room,a=e.dateInt,c=e.loading,u=Object(o.useRef)({current:{scrollHeight:0}}),i=Object(o.useRef)(null),s="";n[n.length-1]&&(s=n[n.length-1].dateTime.dateInt);var m=Object(o.useState)(0),l=Object(w.a)(m,2),f=l[0],d=l[1],b=Object(o.useState)(!1),g=Object(w.a)(b,2),v=g[0],O=g[1];Object(o.useEffect)(function(){var e=function(){return O(!1)};return y.on("loading done",e),function(){return y.removeListener("loading done",e)}},[]),Object(o.useLayoutEffect)(function(){u.current.scrollTop=u.current.scrollHeight-25-(f+u.current.clientHeight)},[v]),Object(o.useLayoutEffect)(function(){c||i.current.scrollIntoView()},[s,c]);var p=n.map(function(e){return r.a.createElement(le,{key:$()()},r.a.createElement("div",{className:"outer"},r.a.createElement("span",{className:"name"},e.userName)," ",r.a.createElement("span",{className:"inner"},e.dateTime.dateString)," ",r.a.createElement("br",null),e.msg))});return r.a.createElement(se,{ref:u,onScroll:function(e){var n=e.target.scrollHeight-(e.target.clientHeight+e.target.scrollTop);d(n),0===e.target.scrollTop&&(y.emit("get messages",t,a),O(!0))}},c?r.a.createElement(be,null):r.a.createElement(r.a.Fragment,null,v&&r.a.createElement(be,null),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null),p,r.a.createElement("div",{ref:i}))))});function ve(){var e=Object(_.a)(["\n  background-color: rgba(0,0,20,0.04);\n"]);return ve=function(){return e},e}var Oe=k.a.div(ve()),pe=Object(u.b)(function(e){return{room:e.rooms[e.activeRoom],user:e.user}})(function(e){var n=e.room,t=e.user;return r.a.createElement(Oe,null,r.a.createElement(V,{placeholder:"Write a message..",buttonText:"Send",onClick:function(e){var o=t.name,r=function(){var e=new Date,n=e.getHours(),t=e.getMinutes(),o=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();return t<10&&(t="0"+t),n<10&&(n="0"+n),o<10&&(o="0"+o),r<10&&(r="0"+r),{dateString:"".concat(o,"/").concat(r,"/").concat(a," ").concat(n,":").concat(t),dateInt:Date.now()}}();y.emit("chat message",{room:n,msg:e,userName:o,dateTime:r})}}))}),Ee=Object(u.b)(function(e){return{inRoom:e.rooms[e.activeRoom],activeRoom:e.activeRoom,rooms:e.rooms}})(function(e){var n=e.inRoom,t=e.activeRoom,o=e.rooms;return r.a.createElement(B,null,r.a.createElement(re,null),n?r.a.createElement(ge,null):r.a.createElement(ue,null),o[t]&&r.a.createElement(pe,null))}),je=function(e){var n=e.title,t=e.user,a=e.rooms,c=e.activeRoom,u=e.roomInfo,i=e.addMessage,s=e.addMessages,m=e.addUserToRoom,l=e.removeUserFromRoom,f=e.setRoomLoading,d=e.setRoomNewMessage,b=Object(o.useState)(""),g=Object(w.a)(b,2),v=g[0],O=g[1];return Object(o.useEffect)(function(){var e=function(){document.hidden||O("")};return document.addEventListener("visibilitychange",e),document.title=n?n+v:"Chat App "+v,function(){return document.removeEventListener("visibilitychange",e)}},[n,v]),Object(o.useEffect)(function(){var e={user:{name:t.name},rooms:a,activeRoom:c};try{var n=JSON.stringify(e);localStorage.setItem("state",n)}catch(o){console.log(o)}},[t,a,c]),Object(o.useEffect)(function(){a.forEach(function(e){""!==e&&""!==t.name&&(f(e,!0),y.emit("join room",e,t),u[e].messages.length||y.emit("get messages",e))})},[t]),Object(o.useEffect)(function(){return y.on("user joined",function(e,n){m(e,n),y.emit("user joined reply",e,t,n)}),y.on("get users in room",function(e,n){m(e,n)}),y.on("get messages",function(e,n){n.length&&(n.reverse(),s(e,n)),f(e,!1)}),y.on("user left",function(e,n){l(e,n)}),function(){return y.removeAllListeners()}},[t]),Object(o.useEffect)(function(){var e=function(e){i(e),e.room!==a[c]&&d(e.room,!0),document.hidden&&O(" (new)")};return y.on("chat message",e),function(){return y.removeListener("chat message",e)}},[a,c]),r.a.createElement(S,null,""===t.name?r.a.createElement(W,null):r.a.createElement(r.a.Fragment,null,r.a.createElement(G,null),r.a.createElement(Ee,null)))},he=Object(u.b)(function(e){return{title:e.rooms[e.activeRoom]||"Chat App",user:e.user,rooms:e.rooms,activeRoom:e.activeRoom,roomInfo:e.roomInfo}},function(e){return{addMessage:function(n){return e(function(e){return{type:"ADD_MESSAGE",message:e}}(n))},addMessages:function(n,t){return e(function(e,n){return{type:"ADD_MESSAGES",room:e,messages:n}}(n,t))},addUserToRoom:function(n,t){return e(function(e,n){return{type:"ADD_USER_TO_ROOM",room:e,user:n}}(n,t))},removeUserFromRoom:function(n,t){return e(function(e,n){return{type:"REMOVE_USER_FROM_ROOM",room:e,user:n}}(n,t))},setRoomLoading:function(n,t){return e(R(n,t))},setRoomNewMessage:function(n,t){return e(x(n,t))}}})(je);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Re=function(){try{var e=localStorage.getItem("state");if((e=JSON.parse(e)).rooms.length<1)e.roomInfo={};else{var n={};e.roomInfo=e.rooms.forEach(function(e){""!==e&&(n[e]={loading:!0,users:[],messages:[],newMessage:!1})}),e.roomInfo=n}return e}catch(t){return}}(),xe=Object(i.b)(p,Re,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__({trace:!0}));c.a.render(r.a.createElement(u.a,{store:xe},r.a.createElement(he,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[52,1,2]]]);
//# sourceMappingURL=main.44b6c205.chunk.js.map